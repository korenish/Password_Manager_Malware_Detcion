import pandas as pd

UNPARSED_DLL_LIBRARIES_PATH = "../../../resources/unparsed_dll_libraries.csv"
PARSED_DLL_LIBRARIES_PATH = "../../../resources/parsed_dll_libraries.csv"


def parse_dll_libraries_to_set(filename: str):
    dll_libraries_raw = pd.read_csv(filename, encoding="ISO-8859-1")

    global_dll_libraries_set = set()
    for raw_libs in dll_libraries_raw['dll_libraries']:
        parsed_libs = raw_libs.split(' ')
        legal_parsed_libs = [lib for lib in parsed_libs
                             if '.dll' in lib and ('/' not in lib or '\\' not in lib)]

        global_dll_libraries_set = global_dll_libraries_set.union(legal_parsed_libs)

    return global_dll_libraries_set


def write_parsed_dlls_as_csv(dll_libs_set: set):
    unique_libs_list = list(dll_libs_set)
    parsed_libs_df = pd.DataFrame({'dll_libraries': unique_libs_list})

    parsed_libs_df.to_csv(PARSED_DLL_LIBRARIES_PATH, index=False)


if __name__ == '__main__':
    global_dll_set = parse_dll_libraries_to_set(UNPARSED_DLL_LIBRARIES_PATH)
    write_parsed_dlls_as_csv(global_dll_set)

import requests

# VirusTotal API key
VT_API_KEY = "71fd05c1b79164c2feb763cbecfe4fe6f84348b2e6ba1f1c21cdb42a6db96eab"

# VirusTotal API v3 URL
VT_API_URL = "https://www.virustotal.com/api/v3/files/"


# upload malicious file to VirusTotal and analyse
class FetchSha256MitreTTPs:
    def __init__(self):
        self.headers = {
            "x-apikey": VT_API_KEY,
            "User-Agent": "vtscan v.1.0",
            "Accept-Encoding": "gzip, deflate",
        }

    def fetch_mitre_ttps(self, sha256):
        print("get info about the results of analysis...")
        mitre_ttps_url = VT_API_URL + f"{sha256}/behaviour_mitre_trees"
        try:
            res = requests.get(mitre_ttps_url, headers=self.headers)
        except:
            print("failed to get info, cannot send API req :(")

        else:
            if res.status_code == 200:
                result = res.json()
                status = result.get("data").get("attributes").get("status")

            else:
                print(f"failed to get results of analysis - status code: {str(res.status_code)}")
